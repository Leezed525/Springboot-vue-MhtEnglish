<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lee.mht.business.dao.WordDao">
    <cache type="com.lee.mht.system.config.MybatisRedisCache"/>
    <resultMap id="baseResultMap" type="com.lee.mht.business.entity.Word">
        <id column="id" property="id"/>
        <result column="word" property="word" javaType="string"/>
        <result column="symbols" property="symbols" javaType="string"/>
        <result column="part" property="part" javaType="string"/>
        <result column="mean" property="mean" javaType="integer"/>
        <result column="ex" property="ex" javaType="string"/>
        <result column="tran" property="tran" javaType="string"/>
        <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
    </resultMap>
    <select id="RandomSelectWordByNumber" resultType="com.lee.mht.business.entity.Word" useCache="false">
        SELECT *
        FROM `words`
        WHERE id not in
              (SELECT w_id FROM `complete_word` where u_id = #{userId})
        ORDER BY RAND()
        LIMIT #{number}
    </select>
    <select id="getRightOption" resultType="com.lee.mht.business.vo.WordOptionsVo">
        SELECT CONCAT(part, mean) AS mean, 1 AS 'right'
        FROM words
        WHERE id = #{id}
    </select>

    <select id="getErrorOption" resultType="com.lee.mht.business.vo.WordOptionsVo">
        SELECT CONCAT(part, mean) AS mean, 0 AS 'right'
        FROM words
        WHERE id != #{id}
        ORDER BY RAND()
        LIMIT 3;
    </select>

    <insert id="learnComplete">
        INSERT INTO complete_word(u_id, w_id, createtime)
        VALUES
        <foreach collection="words" item="word" separator=",">
            (#{uId},#{word.id},NOW())
        </foreach>
    </insert>

    <select id="getCompleteWordCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM complete_word
        WHERE u_id = #{uId}
    </select>
    <select id="getAllCompleteWord" resultType="com.lee.mht.business.entity.Word">
        SELECT w.id,
               w.word,
               w.symbols,
               w.part,
               w.mean,
               w.ex,
               w.tran
        from complete_word as c
        LEFT JOIN words as w ON c.w_id = w.id
        <where>
            <if test="word != null and ! &quot;&quot;.equals(word)">
                <bind name="myWord" value="'%' + word  + '%'"/>
                word like #{myWord}
            </if>
            AND c.u_id = #{uId}
        </where>
    </select>
</mapper>