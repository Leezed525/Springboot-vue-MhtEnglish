<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lee.mht.system.dao.AdminUserDao">
    <resultMap id="baseResultMap" type="AdminUser">
        <id column="id" property="id"/>
        <result column="username" property="username" javaType="string"/>
        <result column="nickname" property="nickname" javaType="string"/>
        <result column="password" property="password" javaType="string"/>
        <result column="role_id" property="roleId"/>
        <result column="available" property="available" javaType="Boolean"/>
        <result column="createtime" property="createtime" jdbcType="TIMESTAMP"/>
        <result column="salt" property="salt" javaType="string"/>
    </resultMap>

    <select id="getAdminUserByUsername" parameterType="String" resultMap="baseResultMap">
        SELECT id,username,nickname,role_id,available FROM admin_user WHERE username = #{username}
    </select>

    <select id="login" parameterType="String" resultMap="baseResultMap">
        <!-- IFNULL(MAX( id ),0) 用来防止mybatis查询查不到结果时报错的问题 -->
        SELECT IFNULL(MAX( id ),0) AS id,username,password,nickname,role_id,available ,salt FROM admin_user
        WHERE username = #{username}
    </select>

    <select id="getpasswordByUsername" parameterType="String"   resultType="String">
        SELECT password FROM admin_user
        WHERE username = #{username}
    </select>

    <!--查-->
    <select id="getAllAdminUser"  resultMap="baseResultMap">
        SELECT id,username,nickname,role_id,available
        FROM admin_user
        <where>
            <if test="username != null and ! &quot;&quot;.equals(username)">
                <bind name="myUsername" value="'%' + username + '%'"/>
                username like #{myUsername}
            </if>
            <if test="nickname != null and ! &quot;&quot;.equals(nickname)">
                <bind name="myNickname" value="'%' + nickname + '%'"/>
                nickname like #{myNickname}
            </if>
            <if test="role_id != null">
                role_id = #{role_id}
            </if>
        </where>
    </select>
    <!--改-->
    <update id="updateAdminUser" parameterType="AdminUser">
        UPDATE admin_user
        <set>
            <if test="adminUser.nickname != null and ! &quot;&quot;.equals(adminUser.nickname)">
                nickname = #{adminUser.nickname},
            </if>
            <if test="adminUser.roleId != null">
                role_id = #{adminUser.roleId},
            </if>
        </set>
        WHERE
        id = #{adminUser.id};
    </update>

    <!--删-->
    <delete id="deleteAdminUserByIds">
        DELETE FROM admin_user
        WHERE id in
        <foreach collection="ids" item = "id" index = "no" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!--增-->
    <insert id="addAdminUser" parameterType="AdminUser">
        INSERT INTO admin_user (username,nickname,password,role_id,createtime,salt)
        VALUES (#{user.username},#{user.nickname},#{user.password},#{user.roleId},NOW(),#{user.salt})
    </insert>

    <!--重置密码-->
    <update id="restPassword" >
        update admin_user
        <set>
            password = #{password},
            salt = #{salt}
        </set>
        <where>
            id = #{id}
        </where>
    </update>
</mapper>